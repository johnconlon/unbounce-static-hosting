import { ready } from "dom-utils";
import { getForm } from "./form";

// Initialize an app in an Unbounce page. Finds a container to inject
// the app content into (containerId is the id of the container to find), and
// fixes some default Unbounce styling which is otherwise difficult to work
// with.
// Invokes a callback with the container and a reference to the Unbounce form.
export function init(containerId: string, cb: Function) {
  ready(function(){
    const container = getContainer(containerId);
    const form = getForm();
    cb(container, form);
  });
}

function getContainer(containerId: string) {
  const container = document.getElementById(containerId);
  if (!container) {
    throw new Error("Can't find the unbounce container: " + containerId);
  }
  const containerParent = container.parentElement;
  if (containerParent) {
    containerParent.style.position = "relative";
    containerParent.style.overflow = "visible";
    containerParent.style.height = "auto";
  }
  return container
}
