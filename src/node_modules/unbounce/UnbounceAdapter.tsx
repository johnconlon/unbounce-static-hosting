import { h, Component, ComponentChildren } from "preact";
import * as UnbounceForm from "./form";
import FauxFormData from "faux-form-data"

export interface Props {
  form: UnbounceForm.UnbounceForm;
  children: any;
}

export default class UnbounceAdapter extends Component<Props> {
  onSubmit = (event: Event) => {
    event.preventDefault()

    const submittedForm = event.target as HTMLFormElement
    if (!submittedForm) throw new Error("Recieving an onSubmit without a form")

    const formData = new FauxFormData(submittedForm)
    UnbounceForm.fill(formData, this.props.form)
    UnbounceForm.submit(this.props.form)
  }

  render(props: Props) {
    return props.children[0](this.onSubmit);
  }
}
